@page
@model Front_end.Web.Pages.Dashboard.AIChatModel
@{
    ViewData["Title"] = "AI Chat";
    Layout = "_DashboardLayout";
}

<div class="card" style="height: calc(100vh - 140px); display: flex; flex-direction: column; padding: 0; overflow: hidden;">
    <!-- Chat Header -->
    <div class="card-header" style="background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%); color: white; padding: 1.5rem; border-bottom: none; border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;">
        <div class="flex-between">
            <div class="flex-center" style="gap: 1rem;">
                <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-robot" style="font-size: 1.2rem;"></i>
                </div>
                <div>
                    <h2 style="margin: 0; font-size: 1.2rem; color: white;">AI Assistant</h2>
                    <p style="margin: 0; font-size: 0.8rem; opacity: 0.8;">Powered by Google Gemini</p>
                </div>
            </div>
            <button class="btn btn-sm" style="background: rgba(255,255,255,0.2); color: white; border: none;">
                <i class="fas fa-ellipsis-v"></i>
            </button>
        </div>
    </div>

    <!-- Chat Messages Area -->
    <div class="chat-messages" style="flex: 1; padding: 1.5rem; overflow-y: auto; background-color: var(--color-gray-50); display: flex; flex-direction: column; gap: 1.5rem;">
        <!-- Welcome Message -->
        <div class="message ai">
            <div class="message-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
                <p>Hello! I'm your AI assistant. How can I help you manage your employees or analyze data today?</p>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.UserMessage))
        {
            <!-- User Message -->
            <div class="message user">
                <div class="message-content">
                    <p>@Model.UserMessage</p>
                </div>
                <div class="message-avatar">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.AiResponse))
        {
            <!-- AI Response -->
            <div class="message ai">
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    @Html.Raw(Model.AiResponse.Replace("\n", "<br>"))
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="message system error">
                <i class="fas fa-exclamation-circle"></i>
                <span>@Model.ErrorMessage</span>
            </div>
        }
    </div>

    <!-- Chat Input Area -->
    <div class="chat-input-area" style="padding: 1.5rem; background: white; border-top: 1px solid var(--color-gray-200);">
        <form method="post" style="display: flex; gap: 1rem;">
            <div style="flex: 1; position: relative;">
                <textarea asp-for="UserMessage" 
                          class="form-control" 
                          placeholder="Type your message..." 
                          style="resize: none; height: 50px; padding-right: 50px; border-radius: 25px; line-height: 1.5; padding-top: 12px;"
                          required></textarea>
                <button type="button" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--color-gray-400); cursor: pointer;">
                    <i class="fas fa-paperclip"></i>
                </button>
            </div>
            <button type="submit" class="btn btn-primary btn-icon" style="width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-paper-plane"></i>
            </button>
        </form>
    </div>
</div>

<style>
    .message {
        display: flex;
        gap: 1rem;
        max-width: 80%;
    }

    .message.user {
        align-self: flex-end;
        flex-direction: row-reverse; /* Avatar on right */
    }

    .message.ai {
        align-self: flex-start;
    }

    .message-avatar {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 0.9rem;
    }

    .message.ai .message-avatar {
        background-color: var(--color-primary-light);
        color: white;
    }

    .message.user .message-avatar {
        background-color: var(--color-gray-300);
        color: var(--color-gray-700);
    }

    .message-content {
        padding: 1rem;
        border-radius: 1rem;
        font-size: 0.95rem;
        line-height: 1.5;
        box-shadow: var(--shadow-sm);
    }

    .message.ai .message-content {
        background-color: white;
        color: var(--color-gray-800);
        border-top-left-radius: 0;
    }

    .message.user .message-content {
        background-color: var(--color-primary);
        color: white;
        border-top-right-radius: 0;
    }

    .message.system.error {
        align-self: center;
        background-color: #fee;
        color: var(--color-danger);
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
</style>
